<div align="center">
  <img src="https://storage.googleapis.com/hume-public-logos/hume/hume-banner.png">
  <h1>Empathic Voice Interface | TypeScript Webhook Example</h1>
  <p>
    <strong>Receive and Handle Webhook Events from Hume's Empathic Voice Interface (EVI)</strong>
  </p>
</div>

## Overview

**This project demonstrates how to:**

- Set up a basic (Node) Express server to receive webhook events from Hume's [Empathic Voice Interface (EVI)](https://dev.hume.ai/docs/empathic-voice-interface-evi/overview).
- Handle `chat_started`, `chat_ended`, and `tool_call` webhook events.
- Process events to create workflows, such as generating transcripts or logging session details.

**Key Features:**

- **Webhook integration:** Configurable endpoint to receive real-time events.
- **Event handling:** Parse and process `chat_started`, chat_ended`, and `tool_call` events with utilities.
- **Extensibility:** A base framework for building advanced workflows triggered by EVI events.

## Prerequisites

To run this project locally, ensure your development environment meets the following requirements:

- [Node.js](https://nodejs.org/en) (`v18.0.0` or higher)
- [pnpm](https://pnpm.io/installation) (`v8.0.0` or higher)

To check the versions of `pnpm` and `Node.js` installed on a Mac via the terminal, you can use the following commands:

1. **For Node.js**, enter the following command and press Enter:

```bash
node -v
```

This command will display the version of Node.js currently installed on your system, for example, `v21.6.1`.

2. **For pnpm**, type the following command and press Enter:

```bash
pnpm -v
```

This command will show the version of `pnpm` that is installed, like `8.10.0`.

If you haven't installed these tools yet, running these commands will result in a message indicating that the command was not found. In that case, you would need to install them first. Node.js can be installed from its official website or via a package manager like Homebrew, and `pnpm` can be installed via npm (which comes with Node.js) by running `npm install -g pnpm` in the terminal.

## Setup

### Setting up credentials

- **Obtain Your API Key**: Follow the instructions in the [Hume documentation](https://dev.hume.ai/docs/introduction/api-key) to acquire your API key.
- **Create a `.env` File**: In the project's root directory, create a `.env` file if it doesn't exist. Add your API key:

```sh
HUME_API_KEY="<YOUR_API_KEY>"
```

Refer to `.env.example` as a template.

### Install dependencies

Install the required dependencies with pnpm: `pnpm install`

## Usage

### Running the server

Start the Express server by running the `main.ts` file:

`pnpm start`

### Testing the webhook

Use [ngrok](https://ngrok.com/) or a similar tool to expose your local server to the internet:

`ngrok http 5000`

Copy the public URL generated by ngrok and update your webhook configuration in the Hume **Config**:

- **Webhook URL**: `<NGROK_PUBLIC_URL>/hume-webhook`
- **Events**: Subscribe to `chat_started` and `chat_ended`.

### Creating a webhook test config

1. Create a get_current_weather tool:

   ```cURL
   curl https://api.hume.ai/v0/evi/tools \
    -H "X-Hume-Api-Key: <YOUR_API_KEY>" \
    --json '{
      "name": "get_current_weather",
      "description": "This tool is for getting the current weather in a given locale.",
      "version_description": "Fetches current weather and uses celsius or fahrenheit based on location of user.",
      "parameters": "{ \"type\": \"object\", \"properties\": { \"location\": { \"type\": \"string\", \"description\": \"The city and state, e.g. San Francisco, CA\" }, \"format\": { \"type\": \"string\", \"enum\": [\"celsius\", \"fahrenheit\"], \"description\": \"The temperature unit to use. Infer this from the users location.\" } }, \"required\": [\"location\", \"format\"] }",
      "fallback_content": "The weather API is unavailable. Unable to fetch the current weather."
    }'
   ```

2. Create an EVI test configuration equipped with that tool:

   ```cURL
   curl https://api.hume.ai/v0/evi/configs \
    -H "X-Hume-Api-Key: <YOUR_API_KEY>" \
    --json '{
      "evi_version": "3",
      "name": "Webhook Test Config",
      "voice": {
        "name": "Ava Song",
        "provider": "HUME_AI"
      },
      "language_model": {
        "model_provider": "ANTHROPIC",
        "model_resource": "claude-sonnet-4-5-20250929"
      },
      "tools": [{
        "id": "<YOUR_TOOL_ID>"
      }],
      "webhooks": [{
        "url": "<NGROK_PUBLIC_URL>/hume-webhook",
        "events": ["chat_started", "chat_ended", "tool_call"]
      }]
    }'
   ```

## How It Works

1. **Webhook Endpoint**: The Express server listens for POST requests at `/hume-webhook`.
2. **Event Processing**:
   - `chat_started`: Logs session details or triggers workflows.
   - `chat_ended`: Processes chat data to generate transcripts or perform analytics.
3. **Custom Logic**: Extend the event handler functions in `main.ts` to integrate with your systems.

