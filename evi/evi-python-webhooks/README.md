<div align="center">
  <img src="https://storage.googleapis.com/hume-public-logos/hume/hume-banner.png">
  <h1>Empathic Voice Interface | Python Webhook Example</h1>
  <p>
    <strong>Receive and Handle Webhook Events from Hume's Empathic Voice Interface (EVI)</strong>
  </p>
</div>

## Overview

**This project demonstrates how to:**

- Set up a basic FastAPI server to receive webhook events from Hume's [Empathic Voice Interface (EVI)](https://dev.hume.ai/docs/empathic-voice-interface-evi/overview).
- Handle `chat_started`, `chat_ended`, and `tool_call` webhook events.
- Process events to create workflows, such as generating transcripts or logging session details.

**Key Features:**

- **Webhook integration:** Configurable endpoint to receive real-time events.
- **Event handling:** Parse and process `chat_started`, `chat_ended`, and `tool_call` events with Python utilities.
- **Extensibility:** A base framework for building advanced workflows triggered by EVI events.

---

## Prerequisites

Ensure your environment meets the following requirements:

- **Python**: Version `3.11.6` or higher
- **Poetry**: Version `1.7.1` or higher

If you need to update or install Poetry, visit the [official Poetry website](https://python-poetry.org/).

---

## Setup Instructions

1. Clone this examples repository:

   ```shell
   git clone https://github.com/humeai/hume-api-examples
   cd hume-api-examples/evi/evi-python-webhooks
   ```

2. Set up API credentials:

   - **Obtain Your API Key**: Follow the instructions in the [Hume documentation](https://dev.hume.ai/docs/introduction/api-key) to acquire your API key.
   - **Create a `.env` File**: In the project's root directory, create a `.env` file if it doesn't exist. Add your API key:

      ```sh
      HUME_API_KEY="<YOUR_API_KEY>"
      ```

   - If you are testing the `tool_call` webhook event, add your Geocoding API key to the `.env` file. You can obtain it for free from [geocode.maps.co](https://geocode.maps.co/).

      ```sh
      GEOCODING_API_KEY="<YOUR_GEOCODING_API_KEY>"
      ```

   Refer to `.env.example` as a template.

3. Install the required dependencies with Poetry:

   ```sh
   poetry install
   ```

## Usage

### Running the server:

Start the FastAPI server by running the `app.py` file:

```sh
poetry run python app.py
```

### Testing the webhook:

Use [ngrok](https://ngrok.com/) or a similar tool to expose your local server to the internet:

```sh
ngrok http 5000
```

You will copy the public URL generated by ngrok and include it in your webhook test config.

#### Creating a webhook test config

1. Create a get_current_weather tool:

   ```cURL
   curl https://api.hume.ai/v0/evi/tools \
    -H "X-Hume-Api-Key: <YOUR_API_KEY>" \
    --json '{
      "name": "get_current_weather",
      "description": "This tool is for getting the current weather in a given locale.",
      "version_description": "Fetches current weather and uses celsius or fahrenheit based on location of user.",
      "parameters": "{ \"type\": \"object\", \"properties\": { \"location\": { \"type\": \"string\", \"description\": \"The city and state, e.g. San Francisco, CA\" }, \"format\": { \"type\": \"string\", \"enum\": [\"celsius\", \"fahrenheit\"], \"description\": \"The temperature unit to use. Infer this from the users location.\" } }, \"required\": [\"location\", \"format\"] }",
      "fallback_content": "The weather API is unavailable. Unable to fetch the current weather."
    }'
   ```

2. Create an EVI test configuration equipped with that tool and your webhook URL:

   ```cURL
   curl https://api.hume.ai/v0/evi/configs \
    -H "X-Hume-Api-Key: <YOUR_API_KEY>" \
    --json '{
      "evi_version": "3",
      "name": "Webhook Test Config",
      "voice": {
        "name": "Ava Song",
        "provider": "HUME_AI"
      },
      "language_model": {
        "model_provider": "ANTHROPIC",
        "model_resource": "claude-sonnet-4-5-20250929"
      },
      "tools": [{
        "id": "<YOUR_TOOL_ID>"
      }],
      "webhooks": [{
        "url": "<NGROK_PUBLIC_URL>/hume-webhook",
        "events": ["chat_started", "chat_ended", "tool_call"]
      }]
    }'
   ```

## How It Works

1. **Webhook Endpoint**: The FastAPI server listens for POST requests at `/hume-webhook`.
2. **Event Processing**:
   - `chat_started`: Logs session details or triggers workflows.
   - `chat_ended`: Processes chat data to generate transcripts or perform analytics.
   - `tool_call`: Completes `get_current_weather` tool call server-side.
3. **Custom Logic**: Extend the event handler functions in `app.py` to integrate with your systems.
